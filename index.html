<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen"/>
  <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>Caronas-jsp</title>
  <meta name="description" content="">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Caronas-jsp</h1>
    </header>
    <div id="container">
      <p class="tagline"></p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/hugonomura/caronas-jsp/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/hugonomura/caronas-jsp/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/hugonomura/caronas-jsp" class="code">View Caronas-jsp on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h2>Caronas</h2>

<h2></h2>

<p>Continuando nosso projeto de caronas, agora iremos usar <strong>JSP</strong>.<br>
Iremos mexer no método <strong>doPost</strong> do <em>controller</em> <code>EfetuaLogin</code>, e caso o usuário seja <code>adm</code>, irão ser abertas novas opções no menu.  </p>

<h2></h2>

<h2>Bean</h2>

<p>A primeira coisa que devemos fazer é criar o bean que sera recuperado na view.<br>
Para isso, basta clicar com o botão direito na raiz do projeto, selecionar a opção <code>Novo</code> &gt; <code>Classe Java</code>.<br>
Em <code>Nome da classe</code>, preencha com <strong>Usuario</strong> e em <code>Pacote</code>, preencha com <strong>model</strong>.<br><a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/img27.png"></a><br>
Clique em <strong>Finalizar</strong>.  </p>

<p>Dentro da classe criada, iremos precisar de dois atributos do tipo String, sendo um para sabermos o tipo do usuário e outro para sabermos o usuario.<br>
Para isso, basta adicionarmos...  </p>

<pre><code>private String usuario;
private String tipo;
</code></pre>

<p>Como precisamos dos getters e setters, podemos usador o <strong>gerador de código</strong> do Netbeans. Para isso, basta usarmos o atalho <code>Alt</code> + <code>Insert</code>, selecionarmos a Opção <strong>Getter e setter</strong>.<br>
Selecionar os campos que queremos os <strong>Getters</strong> e <strong>Setters</strong>, no nosso caso, todos os campos.  </p>

<p><a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/img28.png"></a>  </p>

<p>E clicar em <strong>Gerar</strong>.  </p>

<h2></h2>

<h2>doPost</h2>

<p>Dentro do método <strong>doPost</strong> (que está dentro do servlet <code>EfetuaLogin</code>), remova as linhas de código que estiverem nela, deixando apenas a declaração do método.<br><a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/img20.png"></a>  </p>

<p>Vamos fazer a recuperação dos dados do formulário normalmente no <strong>servlet</strong>, da seguinte forma:  </p>

<pre><code>  String login = request.getParameter("login");
  String senha = request.getParameter("senha");
</code></pre>

<p>Podemos fazer também algum tipo de validação de <strong>login</strong> e <strong>senha</strong>, como ainda não temos acesso ao banco de dados, podemos verificar simplesmente se <strong>login</strong> e <strong>senha</strong> tem o mesmo valor, da seguinte forma:  </p>

<pre><code>  if(login.equals(senha)){
     // aqui faremos o redirecionamento para a página 'logado'
  }
  // aqui faremos o redirecionamento para a página de login
</code></pre>

<p>Agora, por uma questão de comodidade, faremos o redirecionamento de volta para a página de <strong>login</strong>, caso os campos <code>login</code> e <code>senha</code> não possuam o mesmo valor. Para isso, usaremos o método <code>sendRedirect</code>, que pertence ao objeto <strong>response</strong>.<br>
Para isso, basta fazermos isso:  </p>

<pre><code>  response.sendRedirect("/index.jsp");
</code></pre>

<p>Com isso feito, voltemos para o nosso <code>if(login.equals(senha))</code> para realizar o redirecionamento para a página logado.<br>
Primeiro, temos que criar uma instancia de Usuario e retornar os dados para a view através dela. Isso é feito da seguinte forma:  </p>

<pre><code>            Usuario objUsuario=new Usuario();
            objUsuario.setUsuario(login);
</code></pre>

<p>Provavelmente, o <strong>Netbeans</strong> está indicando um erro nessa linha, pois não realizamos o import dessa classe. Resolvemos isso realizando o import no inicio do arquivo.  </p>

<pre><code>import model.Usuario;
</code></pre>

<p>O objeto ainda não está disponível na view, para que ele esteja acessível na view, devemos colocar o objeto instanciando em um atributo, da seguinte forma:  </p>

<pre><code>request.setAttribute("usuarioBean",objUsuario);
</code></pre>

<p>Sendo que, na view iremos recuperar o objeto usando o nome <strong>usuarioBean</strong>.<br>
Para fazermos o redirecionamento, precisamos do método <code>foward</code> pertencente a classe <strong>RequestDispatcher</strong>. Basta criarmos uma instância da classe <strong>RequestDispatcher</strong>, da seguinte forma:  </p>

<pre><code>  RequestDispatcher rd = null;
</code></pre>

<p>Provavelmente, o <strong>Netbeans</strong> está indicando um erro nessa linha, pois, novamente, não realizamos o import dessa classe. Resolvemos isso criando o import para <strong>javax.servlet.RequestDispatcher</strong> (basta adicionar <code>import javax.servlet.RequestDispatcher;</code> junto aos imports no inicio da classe)...<br>
ou podemos simplesmente clicar sobre o ícone apontando o erro na linha...<br><a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/img21.png"></a>  </p>

<p>e pedir para a <strong>IDE</strong> realizar o import.<br><a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/img22.png"></a>  </p>

<pre><code>     rd = request.getRequestDispatcher("/viewLogado.jsp");
     rd.forward(request, response);
</code></pre>

<p>Assim, a nossa página <code>viewLogado</code> irá tratar a requisição.  </p>

<h2></h2>

<h2>Criando a view...</h2>

<p>Para criar uma nova página <strong>JSP</strong>, basta clicarmos com o <strong>botão direito</strong> em <code>Páginas Web</code> &gt; <code>Novo</code> &gt; <code>JSP...</code>  </p>

<p>Mudar o nome do arquivo para viewLogado...
<a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/img23.png"></a>  </p>

<p>E clicar em <code>Finalizar</code>.  </p>

<p>Também devemos alterar o nome de <strong>index.html</strong> para <strong>index.jsp</strong>.<br>
Para fazer isso, basta clicar com o botão direito sobre <code>index.html</code>, selecionar <strong>Propiedades</strong> &gt; <strong>Renomear</strong>.<br>
Alterar a extensão para <strong>jsp</strong>.  </p>

<p><a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/img26.png"></a>  </p>

<p>E clicar em <strong>Fechar</strong>.<br>
Devemos fazer o mesmo com a página <strong>cadastro.html</strong>.  </p>

<p>Como realizamos essa alteração, precisamos arrumar nosso menu também para que nossa aplicação não quebre.<br>
Devemos alterar as ocorrências de <strong>index.html</strong> e <strong>cadastro.html</strong> para <strong>index.jsp</strong> e <strong>cadastro.jsp</strong>, respectivamente.<br>
Isso deve ser feito dentro das páginas <strong>index.jsp</strong> e <strong>cadastro.jsp</strong>.  </p>

<h2></h2>

<h2>Editando a view...</h2>

<p>Agora que já temos a <strong>view</strong> criada, podemos editá-la de acordo com o que realmente queremos fazer.<br>
Podemos apagar todo o conteúdo do arquivo gerado e substituir pelo conteúdo do nosso <code>index.jsp</code>, apenas para termos um ponto de partida.<br>
Como queremos editar o menu superior, devemos encontrar as linhas do menu e alterá-las para aparecer diferentes opções caso o usuário seja do tipo <strong>adm</strong>, conforme o <strong>atributo</strong> que registramos no nosso <strong>servlet</strong>.<br>
Para isso, basta substituir o conteúdo do menu pelo conteúdo abaixo.  </p>

<pre><code>        &lt;% 
            Usuario objUsuarioBean = (Usuario)request.getAttribute("usuarioBean");
            if (objUsuarioBean!=null){
             if(objUsuarioBean.getUsuario().equals("adm")){
          %&gt;
        &lt;li&gt;&lt;a href="#.jsp" class="active"&gt;Autorização de usuário&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href="#.jsp"&gt;Cadastro de Rotas&lt;/a&gt;&lt;/li&gt;
        &lt;%
             }
            }
        %&gt;
</code></pre>

<p>Explicando, o <code>request.getAtribute</code> é igual ao que faziamos no <strong>servlet</strong>, mas como iremos colocar em uma instancia de <strong>Usuario</strong>, devemos fazer um cast.  </p>

<p>Também temos que alterar o conteúdo do <code>article</code>, iremos apenas mostrar uma mensagem de boas vindas para o usuario logado, para isso, devemos fazer o seguinte:  </p>

<pre><code>    &lt;header&gt;
      &lt;%
      if(objUsuarioBean!=null){
        %&gt;
      &lt;h1&gt;Bem vindo ao sistema de caronas &lt;%= objUsuarioBean.getUsuario() %&gt;&lt;/h1&gt;
       &lt;%   
        }else {
        %&gt;
        &lt;h1&gt;Erro no login!&lt;/h1&gt;
        &lt;p&gt; &lt;a href="index.jsp"&gt; Voltar ao Login&lt;/a&gt;&lt;/p&gt;
         &lt;%      }         %&gt;
    &lt;/header&gt;
</code></pre>

<p>Explicando, estamos apenas fazendo uma verificação, onde, caso tenha ocorrido algum problema para instanciar <code>objUsuarioBean</code>, é mostrada uma mensagem de erro e, caso contrário, mostrada a mensagem de boas vindas.  </p>

<h2></h2>

<h1>Resultado</h1>

<p>Ao fim desse tutorial, o método <code>doPost</code> do <strong>servlet</strong> <code>EfetuaLogin</code>, deve estar assim:  </p>

<pre><code>    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String login = request.getParameter("login");
        String senha = request.getParameter("senha");

        if(login.equals(senha)){

                  //vinculo o bean

                  Usuario objUsuario=new Usuario();
                  objUsuario.setUsuario(login);

                  // vincula bean
                  request.setAttribute("usuarioBean",objUsuario);

                  RequestDispatcher rd = null;
                  rd = request.getRequestDispatcher("/viewLogado.jsp");
                  rd.forward(request, response);
        }
        response.sendRedirect("index.jsp");
    }
</code></pre>

<p>E a página <code>viewLogado</code>, deve estar assim:  </p>

<pre><code>    &lt;!DOCTYPE html&gt;
    &lt;%@page import="model.Usuario" %&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;Caronas | Inicio&lt;/title&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;link rel="stylesheet" type="text/css" href="estilo.css"&gt;
        &lt;script src="http://code.jquery.com/jquery-1.9.1.js"&gt;&lt;/script&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;header class="container"&gt;
          &lt;h1 id="logo"&gt;&lt;a href="index.jsp"&gt;Caronas&lt;/a&gt;&lt;/h1&gt;
          &lt;nav id="menu"&gt;
            &lt;ul&gt;
                &lt;% 
                    Usuario objUsuarioBean = (Usuario)request.getAttribute("usuarioBean");
                    if (objUsuarioBean!=null){
                     if(objUsuarioBean.getUsuario().equals("adm")){
                  %&gt;
                &lt;li&gt;&lt;a href="#.jsp" class="active"&gt;Autorização de usuário&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href="#.jsp"&gt;Cadastro de Rotas&lt;/a&gt;&lt;/li&gt;
                &lt;%
                     }
                    }
                %&gt;
            &lt;/ul&gt;
          &lt;/nav&gt;
        &lt;/header&gt;
        &lt;section class="container"&gt;
          &lt;article id="form"&gt;
            &lt;header&gt;
              &lt;%
              if(objUsuarioBean!=null){
                %&gt;
              &lt;h1&gt;Bem vindo ao sistema de caronas &lt;%= objUsuarioBean.getUsuario() %&gt;&lt;/h1&gt;
               &lt;%   
                }else {
                %&gt;
                &lt;h1&gt;Erro no login!&lt;/h1&gt;
                &lt;p&gt; &lt;a href="index.jsp"&gt; Voltar ao Login&lt;/a&gt;&lt;/p&gt;
                 &lt;%      }         %&gt;
            &lt;/header&gt;
           &lt;/article&gt;
        &lt;/section&gt;
        &lt;footer class="container"&gt;
          &lt;p&gt;Desenvolvimento Web - UFSCar Sorocaba - 2013&lt;/p&gt;
        &lt;/footer&gt;
        &lt;script&gt;
          $(document).ready(function(){

          });
        &lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;
</code></pre>

<h2></h2>

<h2>Imagens</h2>

<p>Quando o usuário entrar com o valor <strong>adm</strong> no campo <code>login</code> e <strong>adm</strong> no campo <code>senha</code>, o resultado deve ser:<br><a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/adm.png"></a>  </p>

<p>Quando o usuário entrar com os mesmos valores em <code>login</code> e <code>senha</code>, sendo que o valor dos campos é diferente de <strong>adm</strong>, o resultado deve ser:<br><a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/naoAdm.png"></a>  </p>

<p>Nos outros casos, deve ser mostrada a tela de login, normalmente.  </p>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/hugonomura" class="avatar"><img src="https://secure.gravatar.com/avatar/aba3372625d61846c87c2f8b6cd50659?s=30&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="48" height="48"/></a> <a href="https://github.com/hugonomura">hugonomura</a> maintains <a href="https://github.com/hugonomura/caronas-jsp">Caronas-jsp</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br/>theme by <a href="http://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/hugonomura/caronas-jsp/tarball/master" class="tar">tar</a><a href="https://github.com/hugonomura/caronas-jsp/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

  
</body>
</html>
